name: Job Summary

on:
  workflow_dispatch:
    inputs:
      text_input:
        description: "ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ› (stringåž‹)"
        required: true
        default: "ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤"
        type: string

      number_input:
        description: "æ•°å€¤å…¥åŠ› (numberåž‹)"
        required: true
        default: "42"
        type: number

      boolean_input:
        description: "çœŸå½å€¤å…¥åŠ› (booleanåž‹)"
        required: true
        default: true
        type: boolean

      choice_input:
        description: "é¸æŠžè‚¢å…¥åŠ› (choiceåž‹)"
        required: true
        default: "option2"
        type: choice
        options:
          - option1
          - option2
          - option3

      environment_input:
        description: "ç’°å¢ƒé¸æŠž (environmentåž‹)"
        required: true
        type: environment

      optional_text:
        description: "ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ (required: false)"
        required: false
        type: string

      optional_number:
        description: "ã‚ªãƒ—ã‚·ãƒ§ãƒ³æ•°å€¤ (required: false)"
        required: false
        type: number

      optional_boolean:
        description: "ã‚ªãƒ—ã‚·ãƒ§ãƒ³çœŸå½å€¤ (required: false)"
        required: false
        type: boolean

      optional_choice:
        description: "ã‚ªãƒ—ã‚·ãƒ§ãƒ³é¸æŠžè‚¢ (required: false)"
        required: false
        type: choice
        options:
          - alpha
          - beta
          - gamma

jobs:
  display_input_parameters_from_reusable_workflow:
    uses: ./.github/workflows/display-input-parameters.yml
    with:
      include_keys: '["text_input","environment_input","optional_choice","number_input"]'
  dynamic-inputs-test:
    runs-on: ubuntu-latest
    permissions: {}
    steps:
      - name: Display dynamic summary from inputs
        run: |
          echo "## ðŸ“‹ å®Ÿè¡Œãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®ç¢ºèª" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å | å€¤ |" >> $GITHUB_STEP_SUMMARY
          echo "|--------------|-----|" >> $GITHUB_STEP_SUMMARY
          echo "| **branch**   | \`${{ github.ref_name }}\` |" >> $GITHUB_STEP_SUMMARY
          echo '${{ toJson(github.event.inputs) }}' | jq -r 'to_entries[] | "| **\(.key)** | `\(.value)` |"' >> $GITHUB_STEP_SUMMARY
  full-inputs-test:
    runs-on: ubuntu-latest
    permissions: {}
    steps:
      - name: Display all inputs
        run: |
          echo "## ðŸŽ¯ Workflow Dispatch Inputs Test" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Input Type | Input Name | Value | Type Check |" >> $GITHUB_STEP_SUMMARY
          echo "|------------|------------|-------|------------|" >> $GITHUB_STEP_SUMMARY
          echo "| string | text_input | \`${{ github.event.inputs.text_input }}\` | $(echo '${{ github.event.inputs.text_input }}' | wc -c) chars |" >> $GITHUB_STEP_SUMMARY
          echo "| number | number_input | \`${{ github.event.inputs.number_input }}\` | $(if [[ '${{ github.event.inputs.number_input }}' =~ ^[0-9]+$ ]]; then echo 'âœ… Valid number'; else echo 'âŒ Invalid number'; fi) |" >> $GITHUB_STEP_SUMMARY
          echo "| boolean | boolean_input | \`${{ github.event.inputs.boolean_input }}\` | $(if [[ '${{ github.event.inputs.boolean_input }}' == 'true' || '${{ github.event.inputs.boolean_input }}' == 'false' ]]; then echo 'âœ… Valid boolean'; else echo 'âŒ Invalid boolean'; fi) |" >> $GITHUB_STEP_SUMMARY
          echo "| choice | choice_input | \`${{ github.event.inputs.choice_input }}\` | $(case '${{ github.event.inputs.choice_input }}' in option1|option2|option3) echo 'âœ… Valid choice';; *) echo 'âŒ Invalid choice';; esac) |" >> $GITHUB_STEP_SUMMARY
          echo "| environment | environment_input | \`${{ github.event.inputs.environment_input }}\` | $(echo '${{ github.event.inputs.environment_input }}' | wc -c) chars |" >> $GITHUB_STEP_SUMMARY
          echo "| optional string | optional_text | \`${{ github.event.inputs.optional_text }}\` | $(if [[ -z '${{ github.event.inputs.optional_text }}' ]]; then echo 'ðŸ“ Empty'; else echo "$(echo '${{ github.event.inputs.optional_text }}' | wc -c) chars"; fi) |" >> $GITHUB_STEP_SUMMARY
          echo "| optional number | optional_number | \`${{ github.event.inputs.optional_number }}\` | $(if [[ -z '${{ github.event.inputs.optional_number }}' ]]; then echo 'ðŸ“ Empty'; elif [[ '${{ github.event.inputs.optional_number }}' =~ ^[0-9]+$ ]]; then echo 'âœ… Valid number'; else echo 'âŒ Invalid number'; fi) |" >> $GITHUB_STEP_SUMMARY
          echo "| optional boolean | optional_boolean | \`${{ github.event.inputs.optional_boolean }}\` | $(if [[ -z '${{ github.event.inputs.optional_boolean }}' ]]; then echo 'ðŸ“ Empty'; elif [[ '${{ github.event.inputs.optional_boolean }}' == 'true' || '${{ github.event.inputs.optional_boolean }}' == 'false' ]]; then echo 'âœ… Valid boolean'; else echo 'âŒ Invalid boolean'; fi) |" >> $GITHUB_STEP_SUMMARY
          echo "| optional choice | optional_choice | \`${{ github.event.inputs.optional_choice }}\` | $(if [[ -z '${{ github.event.inputs.optional_choice }}' ]]; then echo 'ðŸ“ Empty'; else case '${{ github.event.inputs.optional_choice }}' in alpha|beta|gamma) echo 'âœ… Valid choice';; *) echo 'âŒ Invalid choice';; esac; fi) |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: Test conditional logic with boolean
        if: ${{ github.event.inputs.boolean_input == 'true' }}
        run: |
          echo "## âœ… Boolean Conditional Test" >> $GITHUB_STEP_SUMMARY
          echo "Boolean input was true, so this step executed!" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: Test conditional logic with choice
        run: |
          echo "## ðŸ”€ Choice Conditional Test" >> $GITHUB_STEP_SUMMARY
          case "${{ github.event.inputs.choice_input }}" in
            "option1")
              echo "You selected Option 1! ðŸ¥‡" >> $GITHUB_STEP_SUMMARY
              ;;
            "option2")
              echo "You selected Option 2! ðŸ¥ˆ" >> $GITHUB_STEP_SUMMARY
              ;;
            "option3")
              echo "You selected Option 3! ðŸ¥‰" >> $GITHUB_STEP_SUMMARY
              ;;
            *)
              echo "Unknown option selected" >> $GITHUB_STEP_SUMMARY
              ;;
          esac
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: Test number operations
        run: |
          echo "## ðŸ”¢ Number Operations Test" >> $GITHUB_STEP_SUMMARY
          NUMBER=${{ github.event.inputs.number_input }}
          DOUBLED=$((NUMBER * 2))
          echo "Original number: $NUMBER" >> $GITHUB_STEP_SUMMARY
          echo "Doubled: $DOUBLED" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: Environment context
        run: |
          echo "## ðŸŒ Environment Context" >> $GITHUB_STEP_SUMMARY
          echo "Selected environment: \`${{ github.event.inputs.environment_input }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

      - name: Raw JSON output
        run: |
          echo "## ðŸ“‹ Raw GitHub Context" >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`json" >> $GITHUB_STEP_SUMMARY
          echo '${{ toJson(github.event.inputs) }}' >> $GITHUB_STEP_SUMMARY
          echo "\`\`\`" >> $GITHUB_STEP_SUMMARY

      - name: Test optional inputs
        run: |
          echo "## ðŸ” Optional Inputs Test" >> $GITHUB_STEP_SUMMARY
          if [[ -n "${{ github.event.inputs.optional_text }}" ]]; then
            echo "Optional text provided: \`${{ github.event.inputs.optional_text }}\`" >> $GITHUB_STEP_SUMMARY
          else
            echo "Optional text was not provided" >> $GITHUB_STEP_SUMMARY
          fi

          if [[ -n "${{ github.event.inputs.optional_number }}" ]]; then
            echo "Optional number provided: \`${{ github.event.inputs.optional_number }}\`" >> $GITHUB_STEP_SUMMARY
          else
            echo "Optional number was not provided" >> $GITHUB_STEP_SUMMARY
          fi

          if [[ -n "${{ github.event.inputs.optional_boolean }}" ]]; then
            echo "Optional boolean provided: \`${{ github.event.inputs.optional_boolean }}\`" >> $GITHUB_STEP_SUMMARY
          else
            echo "Optional boolean was not provided" >> $GITHUB_STEP_SUMMARY
          fi

          if [[ -n "${{ github.event.inputs.optional_choice }}" ]]; then
            echo "Optional choice provided: \`${{ github.event.inputs.optional_choice }}\`" >> $GITHUB_STEP_SUMMARY
          else
            echo "Optional choice was not provided" >> $GITHUB_STEP_SUMMARY
          fi
          echo "" >> $GITHUB_STEP_SUMMARY
      - name: Dump inputs (raw and toJson)
        run: |
          echo "## ðŸ” Debug Inputs" >> $GITHUB_STEP_SUMMARY

          echo "### ðŸŸ¦ Raw inputs" >> $GITHUB_STEP_SUMMARY
          echo '\`\`\`' >> $GITHUB_STEP_SUMMARY
          echo "${{ github.event.inputs }}" >> $GITHUB_STEP_SUMMARY
          echo '\`\`\`' >> $GITHUB_STEP_SUMMARY

          echo "### ðŸŸ¨ toJson(github.event.inputs)" >> $GITHUB_STEP_SUMMARY
          echo '\`\`\`json' >> $GITHUB_STEP_SUMMARY
          echo '${{ toJson(github.event.inputs) }}' >> $GITHUB_STEP_SUMMARY
          echo '\`\`\`' >> $GITHUB_STEP_SUMMARY
